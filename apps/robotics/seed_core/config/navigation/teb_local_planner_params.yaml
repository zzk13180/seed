# ================================================================================
# 文件名: teb_local_planner_params.yaml
# 描  述: TEB 局部路径规划器通用参数配置
#
# 功能说明:
#   TEB (Timed Elastic Band) 是一种时间最优的局部路径规划算法
#   此文件定义规划器的通用参数，机器人特定参数在 vehicle/ 目录下配置
#
# 参考文档:
#   - TEB Local Planner 官方介绍: http://wiki.ros.org/teb_local_planner
#
# 作者: Seed Robotics Team
# 版本: 2.0.0
# ================================================================================

# TEB 局部规划器参数命名空间
TebLocalPlannerROS:
  # ============================================================================
  # ROS 话题和坐标系配置
  # ============================================================================
  
  # 里程计话题
  odom_topic: odom
  
  # 代价地图的 TF 参考坐标系
  map_frame: map

  # ============================================================================
  # 障碍物参数
  # ============================================================================
  
  # 与障碍物的最小距离（米）
  # 直接影响机器人避障效果，值越大越保守
  min_obstacle_dist: 0.25
  
  # 障碍物膨胀距离（米）
  # 在最小距离基础上的额外安全边距
  inflation_dist: 0.6
  
  # 是否包含代价地图障碍物
  include_costmap_obstacles: true
  
  # 机器人后方考虑障碍物的距离（米）
  costmap_obstacles_behind_robot_dist: 1.5
  
  # 障碍物姿态影响数量（0-30）
  # 控制障碍物对轨迹优化的影响范围
  obstacle_poses_affected: 25
  
  # 代价地图转换插件
  # 空字符串表示将所有单元格视为点障碍
  costmap_converter_plugin: ""
  
  # 是否在独立线程中运行代价地图转换
  costmap_converter_spin_thread: true
  
  # 代价地图转换频率（Hz）
  costmap_converter_rate: 5.0
  
  # 是否包含动态障碍物
  # 通过恒定速度模型预测障碍物运动
  include_dynamic_obstacles: true
  
  # 动态障碍物膨胀距离（米）
  dynamic_obstacle_inflation_dist: 0.6

  # ============================================================================
  # 目标点容忍度
  # ============================================================================
  
  # 位置容忍度（米）
  # 机器人到达目标点附近的距离偏差允许量
  xy_goal_tolerance: 0.1
  
  # 朝向容忍度（弧度）
  # 机器人到达目标点时的角度偏差允许量
  yaw_goal_tolerance: 0.1
  
  # 是否允许以最大速度到达目标
  # false: 到达目标时减速停止
  # true: 以当前速度通过目标点
  free_goal_vel: false

  # ============================================================================
  # 轨迹配置参数
  # ============================================================================
  
  # 是否允许自动调整轨迹时域长度
  teb_autosize: true
  
  # 局部路径规划的时间分辨率（秒）
  # 轨迹点之间的期望时间间隔
  # 最小值: 0.01
  dt_ref: 0.45
  
  # 时间分辨率浮动范围（秒）
  # 一般为 dt_ref 的 10% 左右
  # 最小值: 0.002
  dt_hysteresis: 0.1
  
  # 是否覆盖全局路径中的朝向
  global_plan_overwrite_orientation: false
  
  # 考虑优化的全局路径最大长度（米）
  max_global_plan_lookahead_dist: 2.0
  
  # 可行性检查的位姿数量
  # 最小值: 0
  feasibility_check_no_poses: 2

  # ============================================================================
  # 轨迹优化参数
  # ============================================================================
  
  # 内层迭代次数
  # 每次外层迭代中求解器的实际迭代次数
  no_inner_iterations: 5
  
  # 外层迭代次数
  # 每次外层迭代会自动调整轨迹大小
  no_outer_iterations: 4
  
  # 是否启用优化
  optimization_activate: true
  
  # 是否显示优化详情
  optimization_verbose: false
  
  # 惩罚系数的 epsilon 值
  penalty_epsilon: 0.1
  
  # 障碍物代价指数
  obstacle_cost_exponent: 4

  # ============================================================================
  # 优化权重参数
  # ============================================================================
  
  # 最大平移速度的优化权重
  weight_max_vel_x: 2
  
  # 最大角速度的优化权重
  weight_max_vel_theta: 1
  
  # 最大平移加速度的优化权重
  weight_acc_lim_x: 1
  
  # 最大角加速度的优化权重
  weight_acc_lim_theta: 1
  
  # 非完整约束权重
  weight_kinematics_nh: 1000
  
  # 前向驱动权重
  # 高值几乎可以防止倒车（但不能保证）
  weight_kinematics_forward_drive: 1000
  
  # 最小转弯半径权重
  weight_kinematics_turning_radius: 1
  
  # 时间最优权重（必须 > 0）
  weight_optimaltime: 1
  
  # 最短路径权重
  weight_shortest_path: 0
  
  # 障碍物权重
  weight_obstacle: 50
  
  # 膨胀权重
  weight_inflation: 0.2
  
  # 动态障碍物权重
  weight_dynamic_obstacle: 10
  
  # 动态障碍物膨胀权重
  weight_dynamic_obstacle_inflation: 0.2
  
  # 途经点权重
  weight_viapoint: 1
  
  # 自适应因子
  weight_adapt_factor: 2

  # ============================================================================
  # 并行规划（同伦类规划）
  # ============================================================================
  
  # 是否启用同伦类规划
  # 在不同拓扑中并行规划多条轨迹
  enable_homotopy_class_planning: true
  
  # 是否启用多线程
  # 在不同线程中优化各条轨迹
  enable_multithreading: true
  
  # 考虑的最大轨迹数量
  max_number_classes: 5
  
  # 选择代价滞后
  # 新候选轨迹必须具有 old_cost * factor 更低的代价才会被选中
  selection_cost_hysteresis: 1.0
  
  # 障碍物代价缩放
  # 仅用于选择最佳候选轨迹
  selection_obst_cost_scale: 100.0
  
  # 优先选择初始规划
  selection_prefer_initial_plan: 0.95
  
  # 是否使用替代时间代价
  # true: 使用时间差之和
  # false: 使用时间差平方之和
  selection_alternative_time_cost: false
  
  # 路线图采样点数量
  roadmap_graph_no_samples: 15
  
  # 采样区域宽度（米）
  roadmap_graph_area_width: 6
  
  # 采样区域长度缩放
  roadmap_graph_area_length_scale: 1.0
  
  # H-signature 预缩放因子
  h_signature_prescaler: 0.5
  
  # H-signature 阈值
  h_signature_threshold: 0.1
  
  # 障碍物航向阈值
  obstacle_heading_threshold: 0.45
  
  # 切换阻塞周期（秒）
  switching_blocking_period: 0.0
  
  # 是否为所有候选轨迹附加途经点
  viapoints_all_candidates: true
  
  # 是否删除后向绕行
  delete_detours_backwards: true
  
  # 绕行与最佳轨迹的最大时间比
  max_ratio_detours_duration_best_duration: 3.0
  
  # 是否可视化同伦类图
  visualize_hc_graph: false
  
  # 是否以时间作为 Z 轴可视化
  visualize_with_time_as_z_axis_scale: false

  # ============================================================================
  # 恢复行为
  # ============================================================================
  
  # 是否允许临时缩小视野（50%）
  shrink_horizon_backup: true
  
  # 缩小视野的最短持续时间（秒）
  shrink_horizon_min_duration: 10
  
  # 是否启用振荡恢复
  oscillation_recovery: true
  
  # 振荡检测线速度阈值（米/秒）
  oscillation_v_eps: 0.1
  
  # 振荡检测角速度阈值（弧度/秒）
  oscillation_omega_eps: 0.1
  
  # 振荡恢复最短持续时间（秒）
  oscillation_recovery_min_duration: 10
  
  # 振荡过滤持续时间（秒）
  oscillation_filter_duration: 10
